(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  this.app.module('CardEditor', function(CardEditor) {
    var Layer, LayerCollection;
    CardEditor.CardEditorView = (function(_super) {
      __extends(CardEditorView, _super);

      function CardEditorView() {
        this.saveGeneratedCardToImage = __bind(this.saveGeneratedCardToImage, this);
        this.removeShape = __bind(this.removeShape, this);
        this.addShape = __bind(this.addShape, this);
        this.removeLayer = __bind(this.removeLayer, this);
        this.addLayer = __bind(this.addLayer, this);
        this.resize = __bind(this.resize, this);
        this.onShow = __bind(this.onShow, this);
        return CardEditorView.__super__.constructor.apply(this, arguments);
      }

      CardEditorView.prototype.logging = true;

      CardEditorView.prototype.counter = 0;

      CardEditorView.prototype.className = 'card-editor-view';

      CardEditorView.prototype.ui = {
        'canvasContainer': '#canvas-container',
        'slider': '#kaleidoscope-slider',
        'layerList': '.ui-layer-list',
        'addLayer': '.add-layer',
        'removeLayer': '.remove-layer',
        'shapeList': '.ui-shape-list',
        'addShape': '.add-shape',
        'removeShape': '.remove-shape',
        'saveImageFileButton': '.save-to-image'
      };

      CardEditorView.prototype.events = {
        'change @ui.slider': 'onSliderChange',
        'click @ui.addLayer': 'addLayer',
        'click @ui.removeLayer': 'removeLayer',
        'click @ui.addShape': 'addShape',
        'click @ui.removeShape': 'removeShape',
        'click @ui.saveImageFileButton': 'saveGeneratedCardToImage'
      };

      CardEditorView.prototype.initialize = function() {
        this.bind('all', function() {
          if (this.logging === true) {
            return console.log("CARD EDITOR VIEW:\t", arguments);
          }
        });
        this.state = new Backbone.Model({
          currentLayer: {}
        });
        this.model = new Backbone.Model();
        return this.collection = new LayerCollection();
      };

      CardEditorView.prototype.template = function(model) {
        return templatizer.cardEditor.editor(this.model);
      };

      CardEditorView.prototype.onShow = function() {
        var stageHeight, stageParams, stageWidth;
        this.listenTo(app, 'resize', this.resize);
        this.ui.layerList.sortable();
        this.ui.layerList.disableSelection();
        this.ui.shapeList.sortable();
        this.ui.shapeList.disableSelection();
        stageWidth = this.ui.canvasContainer.width();
        stageHeight = this.ui.canvasContainer.height();
        this.stage = new Kinetic.Stage({
          container: "canvas-container",
          width: stageWidth,
          height: 600
        });
        stageParams = {
          scale: this.stage.scale(),
          width: this.ui.canvasContainer.innerWidth(),
          height: this.ui.canvasContainer.innerHeight()
        };
        return this.state.set('stageParams', stageParams);
      };

      CardEditorView.prototype.resize = function() {
        var newStageParams, stageParams, xScale, yScale;
        this.trigger('resize');
        stageParams = this.state.get('stageParams');
        newStageParams = {};
        newStageParams.width = this.ui.canvasContainer.innerWidth();
        newStageParams.height = newStageParams.width * 0.5625;
        xScale = (newStageParams.width / stageParams.width) * stageParams.scale.x;
        yScale = (newStageParams.height / stageParams.height) * stageParams.scale.y;
        newStageParams.scale = {
          x: xScale,
          y: yScale
        };
        this.stage.setAttr("width", newStageParams.width);
        this.stage.setAttr("height", newStageParams.height);
        this.stage.setAttr("scale", newStageParams.scale);
        this.state.set('stageParams', newStageParams);
        return this.stage.draw();
      };

      CardEditorView.prototype.addLayer = function(e, layer, params) {
        params = params || {
          name: 'default layer'
        };
        layer = layer || new Kinetic.Layer(params);
        this.stage.add(layer);
        this.state.set('currentLayer', layer);
        this.collection.add(layer.toObject());
        this.ui.layerList.append("<li class='list-group-item ui-state-default ui-sortable-handle'><span class='ui-icon ui-icon-arrowthick-2-n-s'></span>Слой " + (this.stage.getLayers().length) + "</li>");
        return console.log(this.stage.getLayers().length);
      };

      CardEditorView.prototype.removeLayer = function() {
        var layers;
        layers = this.stage.getLayers();
        if (layers.length > 0) {
          this.ui.layerList.find(".ui-sortable-handle").eq(layers.length - 1).remove();
          layers[layers.length - 1].destroy();
          this.state.set('currentLayer', layers[layers.length - 1] || {});
        }
        return console.log(this.stage.getLayers().length);
      };

      CardEditorView.prototype.addShape = function() {
        var layer, shape;
        console.log('addShape');
        if (this.stage.getLayers().length < 1) {
          this.addLayer();
        }
        layer = this.state.get('currentLayer');
        shape = new Kinetic.RegularPolygon({
          x: app.getRandom(0, this.stage.getWidth()),
          y: app.getRandom(0, this.stage.getHeight()),
          sides: app.getRandom(3, 9),
          radius: app.getRandom(10, 140),
          fillRed: app.getRandom(1, 255),
          fillGreen: app.getRandom(1, 255),
          fillBlue: app.getRandom(1, 255),
          opacity: app.getRandom(0.1, 1, 2),
          draggable: true
        });
        layer.add(shape);
        layer.draw();
        return this.ui.shapeList.append("<li class='list-group-item ui-state-default ui-sortable-handle'><span class='ui-icon ui-icon-arrowthick-2-n-s'></span>Случайная фигура " + (this.state.get('currentLayer').children.length) + "</li>");
      };

      CardEditorView.prototype.removeShape = function() {
        var layer, shapes;
        console.log('removeShape');
        layer = this.state.get('currentLayer');
        shapes = layer.children;
        if (shapes && shapes.length > 0) {
          this.ui.shapeList.find(".ui-sortable-handle").eq(shapes.length - 1).remove();
          shapes[shapes.length - 1].destroy();
          return layer.draw();
        }
      };

      CardEditorView.prototype.saveGeneratedCardToImage = function() {
        return this.stage.toDataURL({
          miteType: "image/png",
          callback: function(data) {
            var image, imageWindow;
            image = data;
            imageWindow = window.open(image);
            return $(imageWindow.document.body).prepend("<p>Нажмите сохранить (ctrl/cmd + s)</p>");
          }
        });
      };

      return CardEditorView;

    })(Marionette.ItemView);
    Layer = (function(_super) {
      __extends(Layer, _super);

      function Layer() {
        return Layer.__super__.constructor.apply(this, arguments);
      }

      return Layer;

    })(Backbone.Model);
    return LayerCollection = (function(_super) {
      __extends(LayerCollection, _super);

      function LayerCollection() {
        return LayerCollection.__super__.constructor.apply(this, arguments);
      }

      LayerCollection.prototype.model = Layer;

      return LayerCollection;

    })(Backbone.Collection);
  });

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNhcmRfZWRpdG9yL1ZpZXcuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQUEsTUFBQTs7bVNBQUE7O0FBQUEsRUFBQSxJQUFDLENBQUEsR0FBRyxDQUFDLE1BQUwsQ0FBWSxZQUFaLEVBQTBCLFNBQUMsVUFBRCxHQUFBO0FBQ3pCLFFBQUEsc0JBQUE7QUFBQSxJQUFNLFVBQVUsQ0FBQztBQUNoQix1Q0FBQSxDQUFBOzs7Ozs7Ozs7OztPQUFBOztBQUFBLCtCQUFBLE9BQUEsR0FBUyxJQUFULENBQUE7O0FBQUEsK0JBQ0EsT0FBQSxHQUFTLENBRFQsQ0FBQTs7QUFBQSwrQkFHQSxTQUFBLEdBQVcsa0JBSFgsQ0FBQTs7QUFBQSwrQkFLQSxFQUFBLEdBQ0M7QUFBQSxRQUFBLGlCQUFBLEVBQW1CLG1CQUFuQjtBQUFBLFFBQ0EsUUFBQSxFQUFVLHNCQURWO0FBQUEsUUFFQSxXQUFBLEVBQWEsZ0JBRmI7QUFBQSxRQUdBLFVBQUEsRUFBYSxZQUhiO0FBQUEsUUFJQSxhQUFBLEVBQWdCLGVBSmhCO0FBQUEsUUFNQSxXQUFBLEVBQWEsZ0JBTmI7QUFBQSxRQU9BLFVBQUEsRUFBWSxZQVBaO0FBQUEsUUFRQSxhQUFBLEVBQWUsZUFSZjtBQUFBLFFBVUEscUJBQUEsRUFBdUIsZ0JBVnZCO09BTkQsQ0FBQTs7QUFBQSwrQkFrQkEsTUFBQSxHQUNDO0FBQUEsUUFBQSxtQkFBQSxFQUFxQixnQkFBckI7QUFBQSxRQUNBLG9CQUFBLEVBQXNCLFVBRHRCO0FBQUEsUUFFQSx1QkFBQSxFQUF5QixhQUZ6QjtBQUFBLFFBR0Esb0JBQUEsRUFBc0IsVUFIdEI7QUFBQSxRQUlBLHVCQUFBLEVBQXlCLGFBSnpCO0FBQUEsUUFLQSwrQkFBQSxFQUFpQywwQkFMakM7T0FuQkQsQ0FBQTs7QUFBQSwrQkE4QkEsVUFBQSxHQUFZLFNBQUEsR0FBQTtBQUNYLFFBQUEsSUFBQyxDQUFBLElBQUQsQ0FBTSxLQUFOLEVBQWEsU0FBQSxHQUFBO0FBQ1osVUFBQSxJQUFn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Q0EsUUFBQSxFQUFVLFNBQUMsSUFBRCxHQUFBO0FBRVQsZ0JBQUEsa0JBQUE7QUFBQSxZQUFBLEtBQUEsR0FBUSxJQUFSLENBQUE7QUFBQSxZQUNBLFdBQUEsR0FBYyxNQUFNLENBQUMsSUFBUCxDQUFZLEtBQVosQ0FEZCxDQUFBO21CQUVBLENBQUEsQ0FBRSxXQUFXLENBQUMsUUFBUSxDQUFDLElBQXZCLENBQTRCLENBQUMsT0FBN0IsQ0FBcUMseUNBQXJDLEVBSlM7VUFBQSxDQURWO1NBREQsRUFEeUI7TUFBQSxDQTNJMUIsQ0FBQTs7NEJBQUE7O09BRHVDLFVBQVUsQ0FBQyxTQUFuRCxDQUFBO0FBQUEsSUF3Sk07QUFBTiw4QkFBQSxDQUFBOzs7O09BQUE7O21CQUFBOztPQUFvQixRQUFRLENBQUMsTUF4SjdCLENBQUE7V0E0Sk07QUFDTCx3Q0FBQSxDQUFBOzs7O09BQUE7O0FBQUEsZ0NBQUEsS0FBQSxHQUFPLEtBQVAsQ0FBQTs7NkJBQUE7O09BRDZCLFFBQVEsQ0FBQyxZQTdKZDtFQUFBLENBQTFCLENBQUEsQ0FBQTtBQUFBIiwiZmlsZSI6ImNhcmRfZWRpdG9yL1ZpZXcuanMiLCJzb3VyY2VSb290IjoiL3NvdXJjZS8iLCJzb3VyY2VzQ29udGVudCI6WyJAYXBwLm1vZHVsZSAnQ2FyZEVkaXRvcicsIChDYXJkRWRpdG9yKSAtPlxuXHRjbGFzcyBDYXJkRWRpdG9yLkNhcmRFZGl0b3JWaWV3IGV4dGVuZHMgTWFyaW9uZXR0ZS5JdGVtVmlld1xuXHRcdGxvZ2dpbmc6IG9uXG5cdFx0Y291bnRlcjogMFxuXG5cdFx0Y2xhc3NOYW1lOiAnY2FyZC1lZGl0b3ItdmlldydcblxuXHRcdHVpOlxuXHRcdFx0J2NhbnZhc0NvbnRhaW5lcic6ICcjY2FudmFzLWNvbnRhaW5lcidcblx0XHRcdCdzbGlkZXInOiAnI2thbGVpZG9zY29wZS1zbGlkZXInXG5cdFx0XHQnbGF5ZXJMaXN0JzogJy51aS1sYXllci1saXN0J1xuXHRcdFx0J2FkZExheWVyJyA6ICcuYWRkLWxheWVyJ1xuXHRcdFx0J3JlbW92ZUxheWVyJyA6ICcucmVtb3ZlLWxheWVyJ1xuXG5cdFx0XHQnc2hhcGVMaXN0JzogJy51aS1zaGFwZS1saXN0J1xuXHRcdFx0J2FkZFNoYXBlJzogJy5hZGQtc2hhcGUnXG5cdFx0XHQncmVtb3ZlU2hhcGUnOiAnLnJlbW92ZS1zaGFwZSdcblxuXHRcdFx0J3NhdmVJbWFnZUZpbGVCdXR0b24nOiAnLnNhdmUtdG8taW1hZ2UnXG5cdFx0XHRcdFx0XG5cdFx0ZXZlbnRzOlxuXHRcdFx0J2NoYW5nZSBAdWkuc2xpZGVyJzogJ29uU2xpZGVyQ2hhbmdlJ1xuXHRcdFx0J2NsaWNrIEB1aS5hZGRMYXllcic6ICdhZGRMYXllcidcblx0XHRcdCdjbGljayBAdWkucmVtb3ZlTGF5ZXInOiAncmVtb3ZlTGF5ZXInXG5cdFx0XHQnY2xpY2sgQHVpLmFkZFNoYXBlJzogJ2FkZFNoYXBlJ1xuXHRcdFx0J2NsaWNrIEB1aS5yZW1vdmVTaGFwZSc6ICdyZW1vdmVTaGFwZSdcblx0XHRcdCdjbGljayBAdWkuc2F2ZUltYWdlRmlsZUJ1dHRvbic6ICdzYXZlR2VuZXJhdGVkQ2FyZFRvSW1hZ2UnXG5cblx0XHQjIGNvbGxlY3Rpb25FdmVudHM6XG5cdFx0IyBcdCdhZGQnOiAnYWRkTGF5ZXInXHRcblxuXG5cdFx0aW5pdGlhbGl6ZTogLT5cblx0XHRcdEBiaW5kICdhbGwnLCAtPlxuXHRcdFx0XHRjb25zb2xlLmxvZyBcIkNBUkQgRURJVE9SIFZJRVc6XFx0XCIsIGFyZ3VtZW50cyBpZiBAbG9nZ2luZyBpcyBvblxuXG5cdFx0XHRAc3RhdGUgICAgICA9IG5ldyBCYWNrYm9uZS5Nb2RlbFxuXHRcdFx0XHRjdXJyZW50TGF5ZXI6IHt9XG5cdFx0XHRAbW9kZWwgICAgICA9IG5ldyBCYWNrYm9uZS5Nb2RlbCgpXG5cdFx0XHRAY29sbGVjdGlvbiA9IG5ldyBMYXllckNvbGxlY3Rpb24oKVxuXG5cdFx0dGVtcGxhdGU6IChtb2RlbCkgLT5cblx0XHRcdHRlbXBsYXRpemVyLmNhcmRFZGl0b3IuZWRpdG9yIEBtb2RlbFxuXG5cdFx0b25TaG93OiA9PlxuXHRcdFx0QGxpc3RlblRvIGFwcCwgJ3Jlc2l6ZScsIEByZXNpemVcblx0XHRcdEB1aS5sYXllckxpc3Quc29ydGFibGUoKVxuXHRcdFx0QHVpLmxheWVyTGlzdC5kaXNhYmxlU2VsZWN0aW9uKClcblx0XHRcdFxuXHRcdFx0QHVpLnNoYXBlTGlzdC5zb3J0YWJsZSgpXG5cdFx0XHRAdWkuc2hhcGVMaXN0LmRpc2FibGVTZWxlY3Rpb24oKVxuXG5cdFx0XHRzdGFnZVdpZHRoID0gQHVpLmNhbnZhc0NvbnRhaW5lci53aWR0aCgpXG5cdFx0XHRzdGFnZUhlaWdodCA9IEB1aS5jYW52YXNDb250YWluZXIuaGVpZ2h0KClcblxuXHRcdFx0QHN0YWdlID0gbmV3IEtpbmV0aWMuU3RhZ2Vcblx0XHRcdFx0Y29udGFpbmVyOiBcImNhbnZhcy1jb250YWluZXJcIlxuXHRcdFx0XHR3aWR0aDogc3RhZ2VXaWR0aFxuXHRcdFx0XHRoZWlnaHQ6IDYwMFxuXG5cdFx0XHRzdGFnZVBhcmFtcyA9XG5cdFx0XHRcdHNjYWxlOiBAc3RhZ2Uuc2NhbGUoKVxuXHRcdFx0XHR3aWR0aDogQHVpLmNhbnZhc0NvbnRhaW5lci5pbm5lcldpZHRoKClcblx0XHRcdFx0aGVpZ2h0OiBAdWkuY2FudmFzQ29udGFpbmVyLmlubmVySGVpZ2h0KClcblxuXHRcdFx0QHN0YXRlLnNldCAnc3RhZ2VQYXJhbXMnLCBzdGFnZVBhcmFtc1xuXG5cdFx0cmVzaXplOiA9PlxuXHRcdFx0QHRyaWdnZXIgJ3Jlc2l6ZSdcblx0XHRcdHN0YWdlUGFyYW1zID0gQHN0YXRlLmdldCAnc3RhZ2VQYXJhbXMnXG5cdFx0XHRuZXdTdGFnZVBhcmFtcyA9IHt9XG5cblx0XHRcdG5ld1N0YWdlUGFyYW1zLndpZHRoID0gQHVpLmNhbnZhc0NvbnRhaW5lci5pbm5lcldpZHRoKCkgIyBuZXcgd2lkdGggb2YgcGFnZVxuXHRcdFx0bmV3U3RhZ2VQYXJhbXMuaGVpZ2h0ID0gbmV3U3RhZ2VQYXJhbXMud2lkdGggKiAwLjU2MjUgIyBuZXcgaGVpZ2h0IG9mIHBhZ2VcblxuXHRcdFx0eFNjYWxlID0gKG5ld1N0YWdlUGFyYW1zLndpZHRoIC8gc3RhZ2VQYXJhbXMud2lkdGgpICogc3RhZ2VQYXJhbXMuc2NhbGUueCAjIHBlcmNlbnQgY2hhbmdlIGluIHdpZHRoIChFeDogMTAwMCAtIDQwMC8xMDAwIG1lYW5zIHRoZSBwYWdlIHNjYWxlZCBkb3duIDYwJSwgeW91IHNob3VsZCBwbGF5IHdpdGggdGhpcyB0byBnZXQgd2FudGVkIHJlc3VsdHMpXG5cdFx0XHR5U2NhbGUgPSAobmV3U3RhZ2VQYXJhbXMuaGVpZ2h0IC8gc3RhZ2VQYXJhbXMuaGVpZ2h0KSAqIHN0YWdlUGFyYW1zLnNjYWxlLnlcblx0XHRcdFxuXHRcdFx0bmV3U3RhZ2VQYXJhbXMuc2NhbGUgPVxuXHRcdFx0XHR4OiB4U2NhbGVcblx0XHRcdFx0eTogeVNjYWxlXG5cblx0XHRcdEBzdGFnZS5zZXRBdHRyIFwid2lkdGhcIiwgbmV3U3RhZ2VQYXJhbXMud2lkdGhcblx0XHRcdEBzdGFnZS5zZXRBdHRyIFwiaGVpZ2h0XCIsIG5ld1N0YWdlUGFyYW1zLmhlaWdodFxuXHRcdFx0QHN0YWdlLnNldEF0dHIgXCJzY2FsZVwiLCBuZXdTdGFnZVBhcmFtcy5zY2FsZVxuXG5cdFx0XHRAc3RhdGUuc2V0ICdzdGFnZVBhcmFtcycsIG5ld1N0YWdlUGFyYW1zXG5cblx0XHRcdEBzdGFnZS5kcmF3KClcblxuXG5cdFx0YWRkTGF5ZXI6IChlLCBsYXllciwgcGFyYW1zKSA9PlxuXHRcdFx0cGFyYW1zID0gcGFyYW1zIG9yXG5cdFx0XHRcdG5hbWU6ICdkZWZhdWx0IGxheWVyJ1xuXHRcdFx0bGF5ZXIgPSBsYXllciBvciBuZXcgS2luZXRpYy5MYXllciBwYXJhbXNcblxuXHRcdFx0QHN0YWdlLmFkZCBsYXllclxuXHRcdFx0QHN0YXRlLnNldCAnY3VycmVudExheWVyJywgbGF5ZXJcblx0XHRcdEBjb2xsZWN0aW9uLmFkZCBsYXllci50b09iamVjdCgpXG5cdFx0XHRAdWkubGF5ZXJMaXN0LmFwcGVuZCBcIjxsaSBjbGFzcz0nbGlzdC1ncm91cC1pdGVtIHVpLXN0YXRlLWRlZmF1bHQgdWktc29ydGFibGUtaGFuZGxlJz48c3BhbiBjbGFzcz0ndWktaWNvbiB1aS1pY29uLWFycm93dGhpY2stMi1uLXMnPjwvc3Bhbj7QodC70L7QuSAjeyBAc3RhZ2UuZ2V0TGF5ZXJzKCkubGVuZ3RoIH08L2xpPlwiXG5cdFx0XHRjb25zb2xlLmxvZyBAc3RhZ2UuZ2V0TGF5ZXJzKCkubGVuZ3RoXG5cdFx0XG5cdFx0cmVtb3ZlTGF5ZXI6ID0+XG5cdFx0XHRsYXllcnMgPSBAc3RhZ2UuZ2V0TGF5ZXJzKClcblx0XHRcdGlmIGxheWVycy5sZW5ndGggPiAwXG5cdFx0XHRcdEB1aS5sYXllckxpc3QuZmluZChcIi51aS1zb3J0YWJsZS1oYW5kbGVcIikuZXEobGF5ZXJzLmxlbmd0aC0xKS5yZW1vdmUoKVxuXHRcdFx0XHRsYXllcnNbbGF5ZXJzLmxlbmd0aC0xXS5kZXN0cm95KClcblx0XHRcdFx0QHN0YXRlLnNldCAnY3VycmVudExheWVyJywgbGF5ZXJzW2xheWVycy5sZW5ndGgtMV0gb3Ige31cblx0XHRcdGNvbnNvbGUubG9nIEBzdGFnZS5nZXRMYXllcnMoKS5sZW5ndGhcblxuXHRcdGFkZFNoYXBlOiA9PlxuXHRcdFx0Y29uc29sZS5sb2cgJ2FkZFNoYXBlJ1xuXHRcdFx0aWYgQHN0YWdlLmdldExheWVycygpLmxlbmd0aCA8IDFcblx0XHRcdFx0QGFkZExheWVyKClcblxuXHRcdFx0bGF5ZXIgPSBAc3RhdGUuZ2V0ICdjdXJyZW50TGF5ZXInXG5cblx0XHRcdHNoYXBlID0gbmV3IEtpbmV0aWMuUmVndWxhclBvbHlnb25cblx0XHRcdFx0eDogYXBwLmdldFJhbmRvbSAwLCBAc3RhZ2UuZ2V0V2lkdGgoKVxuXHRcdFx0XHR5OiBhcHAuZ2V0UmFuZG9tIDAsIEBzdGFnZS5nZXRIZWlnaHQoKVxuXHRcdFx0XHRzaWRlczogYXBwLmdldFJhbmRvbSAzLCA5XG5cdFx0XHRcdHJhZGl1czogYXBwLmdldFJhbmRvbSAxMCwgMTQwXG5cdFx0XHRcdGZpbGxSZWQ6IGFwcC5nZXRSYW5kb20gMSwgMjU1XG5cdFx0XHRcdGZpbGxHcmVlbjogYXBwLmdldFJhbmRvbSAxLCAyNTVcblx0XHRcdFx0ZmlsbEJsdWU6IGFwcC5nZXRSYW5kb20gMSwgMjU1XG5cdFx0XHRcdG9wYWNpdHk6IGFwcC5nZXRSYW5kb20gMC4xLCAxLCAyXG5cdFx0XHRcdGRyYWdnYWJsZTogdHJ1ZVxuXHRcdFx0bGF5ZXIuYWRkIHNoYXBlXG5cdFx0XHRsYXllci5kcmF3KClcblxuXHRcdFx0QHVpLnNoYXBlTGlzdC5hcHBlbmQgXCI8bGkgY2xhc3M9J2xpc3QtZ3JvdXAtaXRlbSB1aS1zdGF0ZS1kZWZhdWx0IHVpLXNvcnRhYmxlLWhhbmRsZSc+PHNwYW4gY2xhc3M9J3VpLWljb24gdWktaWNvbi1hcnJvd3RoaWNrLTItbi1zJz48L3NwYW4+0KHQu9GD0YfQsNC50L3QsNGPINGE0LjQs9GD0YDQsCAjeyBAc3RhdGUuZ2V0KCdjdXJyZW50TGF5ZXInKS5jaGlsZHJlbi5sZW5ndGggfTwvbGk+XCJcblxuXHRcdHJlbW92ZVNoYXBlOiA9PlxuXHRcdFx0Y29uc29sZS5sb2cgJ3JlbW92ZVNoYXBlJ1xuXHRcdFx0bGF5ZXIgPSBAc3RhdGUuZ2V0ICdjdXJyZW50TGF5ZXInXG5cdFx0XHRzaGFwZXMgPSBsYXllci5jaGlsZHJlblxuXHRcdFx0aWYgc2hhcGVzIGFuZCBzaGFwZXMubGVuZ3RoID4gMFxuXHRcdFx0XHRAdWkuc2hhcGVMaXN0LmZpbmQoXCIudWktc29ydGFibGUtaGFuZGxlXCIpLmVxKHNoYXBlcy5sZW5ndGgtMSkucmVtb3ZlKClcblx0XHRcdFx0c2hhcGVzW3NoYXBlcy5sZW5ndGgtMV0uZGVzdHJveSgpXG5cdFx0XHRcdGxheWVyLmRyYXcoKVxuXG5cdFx0c2F2ZUdlbmVyYXRlZENhcmRUb0ltYWdlOiA9PlxuXHRcdFx0QHN0YWdlLnRvRGF0YVVSTFxuXHRcdFx0XHRtaXRlVHlwZTogXCJpbWFnZS9wbmdcIlxuXHRcdFx0XHRjYWxsYmFjazogKGRhdGEpIC0+XG5cdFx0XHRcdFx0IyBpbWFnZSA9IGRhdGEucmVwbGFjZShcImltYWdlL3BuZ1wiLCBcImltYWdlL29jdGV0LXN0cmVhbVwiKVxuXHRcdFx0XHRcdGltYWdlID0gZGF0YVxuXHRcdFx0XHRcdGltYWdlV2luZG93ID0gd2luZG93Lm9wZW4oaW1hZ2UpXG5cdFx0XHRcdFx0JChpbWFnZVdpbmRvdy5kb2N1bWVudC5ib2R5KS5wcmVwZW5kKFwiPHA+0J3QsNC20LzQuNGC0LUg0YHQvtGF0YDQsNC90LjRgtGMIChjdHJsL2NtZCArIHMpPC9wPlwiKTtcblxuXG5cdFx0XHRcblxuXHRjbGFzcyBMYXllciBleHRlbmRzIEJhY2tib25lLk1vZGVsXG5cdFx0IyBkZWZhdWx0czpcblx0XHQjIFx0ekluZGV4OiAwXG5cblx0Y2xhc3MgTGF5ZXJDb2xsZWN0aW9uIGV4dGVuZHMgQmFja2JvbmUuQ29sbGVjdGlvblxuXHRcdG1vZGVsOiBMYXllclxuIl19