(function() {
  var __slice = [].slice;

  this.app.module('CardGenerator.generators.textGen', function(TextGen, app, Backbone, Marionette, $, _) {
    this.draw = function() {
      var args, canvas, cardData, context, eMail, fontFamily, fontsList, model, name, phone, position, randomCardData, randomNameNum, randomPhoneEnd, randomTextOptions, renderText, sex, srcData, surname, textAlign, textOptions;
      canvas = arguments[0], model = arguments[1], args = 3 <= arguments.length ? __slice.call(arguments, 2) : [];
      srcData = dataFromServer.appData;
      srcData.textAligns = ['left', 'center', 'right'];
      fontsList = srcData.fontsList;
      textOptions = model.get('generators.textGen');
      cardData = model.get('data');
      name = cardData.name;
      surname = cardData.surname;
      sex = cardData.sex;
      phone = cardData.phone;
      eMail = cardData.eMail;
      position = cardData.position;
      textAlign = textOptions.textAlign;
      fontFamily = textOptions.fontFamily;
      context = canvas.getContext('2d');
      renderText = (function(_this) {
        return function(fontFamily) {
          var font, paragrafHeight, wrapText, x, y;
          if (fontFamily === 'sans-serif') {
            font = fontFamily;
          } else {
            font = '"' + fontFamily + '"';
          }
          switch (textAlign) {
            case 'left':
              x = 10;
              y = 20;
              break;
            case 'center':
              x = canvas.width / 2;
              y = 20;
              break;
            case 'right':
              x = canvas.width - 10;
              y = 20;
          }
          paragrafHeight = 0;
          wrapText = function(context, text, x, y, maxWidth, lineHeight) {
            var line, linesCounter, metrics, testLine, testWidth, word, words, _i, _len;
            words = text.split(' ');
            line = '';
            linesCounter = 0;
            for (_i = 0, _len = words.length; _i < _len; _i++) {
              word = words[_i];
              linesCounter = _i + 1;
              testLine = line + word + ' ';
              metrics = context.measureText(testLine);
              testWidth = metrics.width;
              if (testWidth > maxWidth && _i > 0) {
                context.fillText(line, x, y);
                line = word + ' ';
                y += lineHeight;
              } else {
                line = testLine;
              }
              paragrafHeight = y;
            }
            return context.fillText(line, x, y);
          };
          context.font = '1.5em ' + font;
          context.textAlign = textAlign;
          context.fillStyle = '#000';
          context.textBaseline = 'middle';
          context.lineWidth = 1.5;
          wrapText(context, _this.renderInitials(sex, name, surname), x, y, canvas.width - 20, 28);
          context.font = '0.8em ' + font;
          if (textAlign === 'right') {
            x -= 5;
          }
          context.fillText('тел.: ' + phone, x, 32 + paragrafHeight);
          context.fillText('email: ' + eMail, x, 49 + paragrafHeight);
          if (textAlign === 'right') {
            x += 5;
          }
          wrapText(context, position, x, 66 + paragrafHeight, canvas.width - 20, 18);
          return context.save();
        };
      })(this);
      if (cardData.isDefault || textOptions.isDefault) {
        randomCardData = {
          isDefault: false
        };
        randomNameNum = app.getRandom(0, srcData.names.length - 1);
        randomPhoneEnd = app.getRandom(0, srcData.names.length - 1);
        if (('' + randomPhoneEnd).length < 2) {
          randomPhoneEnd = '0' + randomPhoneEnd;
        }
        randomCardData.sex = srcData.names[randomNameNum].sex;
        randomCardData.name = srcData.names[randomNameNum].text;
        randomCardData.surname = srcData.surnames[app.getRandom(0, srcData.surnames.length - 1)];
        randomCardData.eMail = srcData.emails[app.getRandom(0, srcData.emails.length - 1)];
        randomCardData.position = srcData.positions[app.getRandom(0, srcData.positions.length - 1)];
        randomCardData.phone = '+7-' + srcData.phones + randomPhoneEnd;
        model.set('data', randomCardData, {
          silent: true
        });
        randomTextOptions = {
          isDefault: false
        };
        randomTextOptions.textAlign = srcData.textAligns[app.getRandom(0, srcData.textAligns.length - 1)];
        randomTextOptions.fontFamily = '' + fontsList[app.getRandom(0, fontsList.length - 1)];
        WebFont.load({
          custom: {
            families: [randomTextOptions.fontFamily],
            urls: ['/assets/font/card_fonts/' + randomTextOptions.fontFamily + '/' + randomTextOptions.fontFamily + '.css']
          },
          fontloading: (function(_this) {
            return function() {};
          })(this),
          fontactive: (function(_this) {
            return function(fontFamily, fontOptions) {
              return _this.draw(canvas, model);
            };
          })(this),
          fontinactive: (function(_this) {
            return function() {
              return _this.draw(canvas, model);
            };
          })(this)
        });
        return model.set('generators.textGen', randomTextOptions, {
          silent: true
        });
      } else {
        return renderText(fontFamily);
      }
    };
    return this.renderInitials = function(sex, name, surname) {
      if (sex === 'male') {
        surname = surname;
      } else if (sex === 'female') {
        if (surname.substr(surname.length - 2, surname.length) === 'ий') {
          surname = surname.slice(0, surname.length - 2);
          surname = surname + 'ая';
        } else {
          surname = surname + 'a';
        }
      }
      return name + ' ' + surname;
    };
  });

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNhcmRfZ2VuZXJhdG9yL2dlbmVyYXRvcnMvdGV4dC1nZW5lcmVhdG9yLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUFBLE1BQUEsa0JBQUE7O0FBQUEsRUFBQSxJQUFDLENBQUEsR0FBRyxDQUFDLE1BQUwsQ0FBWSxrQ0FBWixFQUFnRCxTQUFDLE9BQUQsRUFBVSxHQUFWLEVBQWUsUUFBZixFQUF5QixVQUF6QixFQUFxQyxDQUFyQyxFQUF3QyxDQUF4QyxHQUFBO0FBQy9DLElBQUEsSUFBQyxDQUFBLElBQUQsR0FBUSxTQUFBLEdBQUE7QUFFUCxVQUFBLHdOQUFBO0FBQUEsTUFGUSx1QkFBTyxzQkFBTSw4REFFckIsQ0FBQTtBQUFBLE1BQUEsT0FBQSxHQUFVLGNBQWMsQ0FBQyxPQUF6QixDQUFBO0FBQUEsTUFDQSxPQUFPLENBQUMsVUFBUixHQUFxQixDQUFDLE1BQUQsRUFBUSxRQUFSLEVBQWlCLE9BQWpCLENBRHJCLENBQUE7QUFBQSxNQUVBLFNBQUEsR0FBWSxPQUFPLENBQUMsU0FGcEIsQ0FBQTtBQUFBLE1BR0EsV0FBQSxHQUFjLEtBQUssQ0FBQyxHQUFOLENBQVUsb0JBQVYsQ0FIZCxDQUFBO0FBQUEsTUFJQSxRQUFBLEdBQVcsS0FBSyxDQUFDLEdBQU4sQ0FBVSxNQUFWLENBSlgsQ0FBQTtBQUFBLE1BT0EsSUFBQSxHQUFPLFFBQVEsQ0FBQyxJQVBoQixDQUFBO0FBQUEsTUFRQSxPQUFBLEdBQVUsUUFBUSxDQUFDLE9BUm5CLENBQUE7QUFBQSxNQVNBLEdBQUEsR0FBTSxRQUFRLENBQUMsR0FUZixDQUFBO0FBQUEsTUFVQSxLQUFBLEdBQVEsUUFBUSxDQUFDLEtBVmpCLENBQUE7QUFBQSxNQVdBLEtBQUEsR0FBUSxRQUFRLENBQUMsS0FYakIsQ0FBQTtBQUFBLE1BWUEsUUFBQSxHQUFXLFFBQVEsQ0FBQyxRQVpwQixDQUFBO0FBQUEsTUFlQSxTQUFBLEdBQVksV0FBVyxDQUFDLFNBZnhCLENBQUE7QUFBQSxNQWdCQSxV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RCxDQTdCQSxDQUFBO2VBMkNBLEtBQUssQ0FBQyxHQUFOLENBQVUsb0JBQVYsRUFBZ0MsaUJBQWhDLEVBQ0M7QUFBQSxVQUFBLE1BQUEsRUFBUSxJQUFSO1NBREQsRUE3Q0Q7T0FBQSxNQUFBO2VBaURDLFVBQUEsQ0FBVyxVQUFYLEVBakREO09BaEZPO0lBQUEsQ0FBUixDQUFBO1dBb0lBLElBQUMsQ0FBQSxjQUFELEdBQWtCLFNBQUMsR0FBRCxFQUFNLElBQU4sRUFBWSxPQUFaLEdBQUE7QUFFakIsTUFBQSxJQUFHLEdBQUEsS0FBTyxNQUFWO0FBQ0MsUUFBQSxPQUFBLEdBQVUsT0FBVixDQUREO09BQUEsTUFHSyxJQUFHLEdBQUEsS0FBTyxRQUFWO0FBQ0osUUFBQSxJQUFHLE9BQU8sQ0FBQyxNQUFSLENBQWUsT0FBTyxDQUFDLE1BQVIsR0FBZSxDQUE5QixFQUFnQyxPQUFPLENBQUMsTUFBeEMsQ0FBQSxLQUFtRCxJQUF0RDtBQUNDLFVBQUEsT0FBQSxHQUFVLE9BQU8sQ0FBQyxLQUFSLENBQWMsQ0FBZCxFQUFnQixPQUFPLENBQUMsTUFBUixHQUFlLENBQS9CLENBQVYsQ0FBQTtBQUFBLFVBQ0EsT0FBQSxHQUFVLE9BQUEsR0FBUSxJQURsQixDQUREO1NBQUEsTUFBQTtBQUlDLFVBQUEsT0FBQSxHQUFVLE9BQUEsR0FBUSxHQUFsQixDQUpEO1NBREk7T0FITDthQVNBLElBQUEsR0FBTyxHQUFQLEdBQWEsUUFYSTtJQUFBLEVBckk2QjtFQUFBLENBQWhELENBQUEsQ0FBQTtBQUFBIiwiZmlsZSI6ImNhcmRfZ2VuZXJhdG9yL2dlbmVyYXRvcnMvdGV4dC1nZW5lcmVhdG9yLmpzIiwic291cmNlUm9vdCI6Ii9zb3VyY2UvIiwic291cmNlc0NvbnRlbnQiOlsiQGFwcC5tb2R1bGUgJ0NhcmRHZW5lcmF0b3IuZ2VuZXJhdG9ycy50ZXh0R2VuJywgKFRleHRHZW4sIGFwcCwgQmFja2JvbmUsIE1hcmlvbmV0dGUsICQsIF8pIC0+XG5cdEBkcmF3ID0gKGNhbnZhcyxtb2RlbCxhcmdzLi4uKSAtPlxuXHRcdCMgZ2V0IGN1cnJlbnQgdGV4dCBwdGlvbnMgYW5kIGNhcmQgaW5mbyBmcm9tIG1vZGVsXG5cdFx0c3JjRGF0YSA9IGRhdGFGcm9tU2VydmVyLmFwcERhdGFcblx0XHRzcmNEYXRhLnRleHRBbGlnbnMgPSBbJ2xlZnQnLCdjZW50ZXInLCdyaWdodCddXG5cdFx0Zm9udHNMaXN0ID0gc3JjRGF0YS5mb250c0xpc3Rcblx0XHR0ZXh0T3B0aW9ucyA9IG1vZGVsLmdldCAnZ2VuZXJhdG9ycy50ZXh0R2VuJ1xuXHRcdGNhcmREYXRhID0gbW9kZWwuZ2V0ICdkYXRhJ1xuXHRcdFxuXHRcdCMgY2FyZCBpbmZvXG5cdFx0bmFtZSA9IGNhcmREYXRhLm5hbWVcblx0XHRzdXJuYW1lID0gY2FyZERhdGEuc3VybmFtZVxuXHRcdHNleCA9IGNhcmREYXRhLnNleFxuXHRcdHBob25lID0gY2FyZERhdGEucGhvbmVcblx0XHRlTWFpbCA9IGNhcmREYXRhLmVNYWlsXG5cdFx0cG9zaXRpb24gPSBjYXJkRGF0YS5wb3NpdGlvblxuXHRcdFxuXHRcdCMgdGV4dCBwdGlvbnNcblx0XHR0ZXh0QWxpZ24gPSB0ZXh0T3B0aW9ucy50ZXh0QWxpZ25cblx0XHRmb250RmFtaWx5ID0gdGV4dE9wdGlvbnMuZm9udEZhbWlseVxuXG5cdFx0Y29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpXG5cblx0XHRyZW5kZXJUZXh0ID0gKGZvbnRGYW1pbHkpID0+XG5cdFx0XHRpZiBmb250RmFtaWx5IGlzICdzYW5zLXNlcmlmJ1xuXHRcdFx0XHRmb250ID0gZm9udEZhbWlseVxuXHRcdFx0ZWxzZSBcblx0XHRcdFx0Zm9udCA9ICdcIicrZm9udEZhbWlseSsnXCInXG5cdFx0XHRzd2l0Y2ggdGV4dEFsaWduXG5cdFx0XHRcdHdoZW4gJ2xlZnQnXG5cdFx0XHRcdFx0eCA9IDEwXG5cdFx0XHRcdFx0eSA9IDIwXG5cdFx0XHRcdHdoZW4gJ2NlbnRlcicgXG5cdFx0XHRcdFx0eCA9IGNhbnZhcy53aWR0aC8yXG5cdFx0XHRcdFx0eSA9IDIwXG5cdFx0XHRcdHdoZW4gJ3JpZ2h0J1xuXHRcdFx0XHRcdHggPSBjYW52YXMud2lkdGgtMTBcblx0XHRcdFx0XHR5ID0gMjAgXG5cdFx0XHRwYXJhZ3JhZkhlaWdodCA9IDBcblx0XHRcdFxuXHRcdFx0d3JhcFRleHQgPSAoY29udGV4dCwgdGV4dCwgeCwgeSwgbWF4V2lkdGgsIGxpbmVIZWlnaHQpIC0+XG5cdFx0XHRcdHdvcmRzID0gdGV4dC5zcGxpdCgnICcpXG5cdFx0XHRcdGxpbmUgPSAnJ1xuXHRcdFx0XHRsaW5lc0NvdW50ZXIgPSAwXG5cdFx0XHRcdGZvciB3b3JkIGluIHdvcmRzXG5cdFx0XHRcdFx0IyBjb25zb2xlLmxvZyB3b3JkLF9pXG5cdFx0XHRcdFx0bGluZXNDb3VudGVyID0gX2krMVxuXHRcdFx0XHRcdHRlc3RMaW5lID0gbGluZSArIHdvcmQgKyAnICdcblx0XHRcdFx0XHRtZXRyaWNzID0gY29udGV4dC5tZWFzdXJlVGV4dCh0ZXN0TGluZSlcblx0XHRcdFx0XHR0ZXN0V2lkdGggPSBtZXRyaWNzLndpZHRoXG5cdFx0XHRcdFx0aWYgIHRlc3RXaWR0aCA+IG1heFdpZHRoIGFuZCBfaSA+IDBcblx0XHRcdFx0XHRcdGNvbnRleHQuZmlsbFRleHQobGluZSwgeCwgeSlcblx0XHRcdFx0XHRcdGxpbmUgPSB3b3JkICsgJyAnXG5cdFx0XHRcdFx0XHR5ICs9IGxpbmVIZWlnaHRcblx0XHRcdFx0XHRlbHNlXG5cdFx0XHRcdFx0XHRsaW5lID0gdGVzdExpbmVcblx0XHRcdFx0XHRwYXJhZ3JhZkhlaWdodCA9IHlcblx0XHRcdFx0XHRcblx0XHRcdFx0Y29udGV4dC5maWxsVGV4dChsaW5lLCB4LCB5KVxuXHRcdFx0Y29udGV4dC5mb250ID0gJzEuNWVtICcgKyBmb250XG5cdFx0XHRjb250ZXh0LnRleHRBbGlnbiA9IHRleHRBbGlnblxuXHRcdFx0Y29udGV4dC5maWxsU3R5bGUgPSAnIzAwMCdcblx0XHRcdGNvbnRleHQudGV4dEJhc2VsaW5lID0gJ21pZGRsZSdcblx0XHRcdGNvbnRleHQubGluZVdpZHRoID0gMS41XG5cblx0XHRcdHdyYXBUZXh0IGNvbnRleHQgLCBAcmVuZGVySW5pdGlhbHMoc2V4LCBuYW1lLCBzdXJuYW1lKSwgeCwgeSwgY2FudmFzLndpZHRoLTIwLCAyOFxuXG5cdFx0XHRjb250ZXh0LmZvbnQgPSAnMC44ZW0gJyArIGZvbnRcblx0XHRcdCMgY29uc29sZS5sb2cgJ2NhcmQg4oSWJyArIG1vZGVsLmdldCgnaWQnKSArICcgOiAnICsgZm9udC5zcGxpdCgnXCInKS5qb2luKCcnKVxuXHRcdFx0aWYgdGV4dEFsaWduIGlzICdyaWdodCcgdGhlbiB4LT01XG5cdFx0XHRjb250ZXh0LmZpbGxUZXh0ICfRgtC10LsuOiAnICsgcGhvbmUsIHgsIDMyICtwYXJhZ3JhZkhlaWdodFxuXHRcdFx0Y29udGV4dC5maWxsVGV4dCAnZW1haWw6ICcrIGVNYWlsLCB4LCA0OSArcGFyYWdyYWZIZWlnaHRcblx0XHRcdGlmIHRleHRBbGlnbiBpcyAncmlnaHQnIHRoZW4geCs9NVxuXHRcdFx0d3JhcFRleHQgY29udGV4dCAsIHBvc2l0aW9uLCB4LCA2NiArIHBhcmFncmFmSGVpZ2h0LCBjYW52YXMud2lkdGgtMjAsIDE4XG5cblx0XHRcdGNvbnRleHQuc2F2ZSgpXG5cblx0XHQjIGdlbmVyYXRlUmFuZG9tQ2FyZEluZm9cdFx0XHRcdFxuXHRcdCMgZ2VuZXJhdGVSYW5kb21DYXJkSW5mbyA9IChjYXJkRGF0YSkgLT5cblxuXG5cdFx0aWYgY2FyZERhdGEuaXNEZWZhdWx0IG9yIHRleHRPcHRpb25zLmlzRGVmYXVsdFxuXHRcdFx0I2dlbmVyYXRlIG5ldyByYW5kb20gY2FyZERhdGFcblx0XHRcdHJhbmRvbUNhcmREYXRhID1cblx0XHRcdFx0aXNEZWZhdWx0OiBmYWxzZVxuXG5cdFx0XHQjbG9jYWwgdmFyaWFibGVzXG5cdFx0XHRyYW5kb21OYW1lTnVtID0gYXBwLmdldFJhbmRvbSgwLCBzcmNEYXRhLm5hbWVzLmxlbmd0aC0xIClcblx0XHRcdHJhbmRvbVBob25lRW5kID0gYXBwLmdldFJhbmRvbSgwLCBzcmNEYXRhLm5hbWVzLmxlbmd0aC0xIClcblx0XHRcdHJhbmRvbVBob25lRW5kID0gJzAnICsgcmFuZG9tUGhvbmVFbmQgaWYgKCcnKyByYW5kb21QaG9uZUVuZCkubGVuZ3RoIDwgMiBcblx0XHRcdCNlbmQgbG9jYWwgdmFyaWFibGVzXG5cblx0XHRcdHJhbmRvbUNhcmREYXRhLnNleCA9IHNyY0RhdGEubmFtZXNbIHJhbmRvbU5hbWVOdW0gXS5zZXhcblx0XHRcdHJhbmRvbUNhcmREYXRhLm5hbWUgPSAgc3JjRGF0YS5uYW1lc1sgcmFuZG9tTmFtZU51bSBdLnRleHRcblx0XHRcdHJhbmRvbUNhcmREYXRhLnN1cm5hbWUgPSAgc3JjRGF0YS5zdXJuYW1lc1sgYXBwLmdldFJhbmRvbSgwLCBzcmNEYXRhLnN1cm5hbWVzLmxlbmd0aC0xICkgXVxuXHRcdFx0cmFuZG9tQ2FyZERhdGEuZU1haWwgPSAgc3JjRGF0YS5lbWFpbHNbIGFwcC5nZXRSYW5kb20oMCwgc3JjRGF0YS5lbWFpbHMubGVuZ3RoLTEgKSBdXG5cdFx0XHRyYW5kb21DYXJkRGF0YS5wb3NpdGlvbiA9ICBzcmNEYXRhLnBvc2l0aW9uc1sgYXBwLmdldFJhbmRvbSgwLCBzcmNEYXRhLnBvc2l0aW9ucy5sZW5ndGgtMSApIF1cblx0XHRcdHJhbmRvbUNhcmREYXRhLnBob25lID0gJys3LScgKyBzcmNEYXRhLnBob25lcyArIHJhbmRvbVBob25lRW5kXG5cblx0XHRcdCNzZXQgbmV3IHJhbmRvbSBjYXJkRGF0YSB0byBtb2RlbFxuXHRcdFx0bW9kZWwuc2V0ICdkYXRhJywgcmFuZG9tQ2FyZERhdGEsXG5cdFx0XHRcdHNpbGVudDogdHJ1ZVxuXG5cdFx0XHQjZ2VuZXJhdGUgbmV3IHJhbmRvbSB0ZXh0IG9wdGlvbnNcblx0XHRcdHJhbmRvbVRleHRPcHRpb25zID1cblx0XHRcdFx0aXNEZWZhdWx0OiBmYWxzZVxuXG5cdFx0XHRyYW5kb21UZXh0T3B0aW9ucy50ZXh0QWxpZ24gPSBzcmNEYXRhLnRleHRBbGlnbnNbYXBwLmdldFJhbmRvbSgwLHNyY0RhdGEudGV4dEFsaWducy5sZW5ndGgtMSldXG5cdFx0XHRyYW5kb21UZXh0T3B0aW9ucy5mb250RmFtaWx5ID0gJycrIGZvbnRzTGlzdFsgYXBwLmdldFJhbmRvbSgwLCBmb250c0xpc3QubGVuZ3RoLTEpIF1cblxuXG5cdFx0XHQjIExvYWQgZm9udHMgZGluYW1pY2FseSB0aHJvdWdoIGdvb2dsZSB3ZWIgbG9hZGVyXG5cdFx0XHRXZWJGb250LmxvYWRcblx0XHRcdFx0Y3VzdG9tOlxuXHRcdFx0XHRcdGZhbWlsaWVzOiBbcmFuZG9tVGV4dE9wdGlvbnMuZm9udEZhbWlseV1cblx0XHRcdFx0XHR1cmxzOiBbJy9hc3NldHMvZm9udC9jYXJkX2ZvbnRzLycgKyByYW5kb21UZXh0T3B0aW9ucy5mb250RmFtaWx5ICsgJy8nICsgcmFuZG9tVGV4dE9wdGlvbnMuZm9udEZhbWlseSArICcuY3NzJ11cblx0XHRcdFx0Zm9udGxvYWRpbmc6ICA9PlxuXHRcdFx0XHRcdCMgY29uc29sZS5sb2cgJ2ZvbnRsb2FkaW5nOlxcdCcsIGFyZ3VtZW50c1xuXHRcdFx0XHRmb250YWN0aXZlOiAoZm9udEZhbWlseSwgZm9udE9wdGlvbnMpICA9PlxuXHRcdFx0XHRcdCMgY29uc29sZS5pbmZvICdmb250YWN0aXZlOlxcdCBcXHQnLCBmb250RmFtaWx5LCBAXG5cdFx0XHRcdFx0QGRyYXcoY2FudmFzLCBtb2RlbClcblx0XHRcdFx0Zm9udGluYWN0aXZlOiAgPT5cblx0XHRcdFx0XHQjIGNvbnNvbGUud2FybiAnZm9udGluYWN0aXZlOlxcdCBcXHQnLCBhcmd1bWVudHNcblx0XHRcdFx0XHRAZHJhdyhjYW52YXMsIG1vZGVsKVxuXHRcdFx0XG5cdFx0XHQjc2V0IG5ldyByYW5kb20gdGV4dCBvcHRpb25zIHRvIG1vZGVsXG5cdFx0XHRtb2RlbC5zZXQgJ2dlbmVyYXRvcnMudGV4dEdlbicsIHJhbmRvbVRleHRPcHRpb25zLFxuXHRcdFx0XHRzaWxlbnQ6IHRydWVcblxuXHRcdGVsc2UgXG5cdFx0XHRyZW5kZXJUZXh0KGZvbnRGYW1pbHkpXG5cblxuXHRAcmVuZGVySW5pdGlhbHMgPSAoc2V4LCBuYW1lLCBzdXJuYW1lKSAtPlxuXG5cdFx0aWYgc2V4IGlzICdtYWxlJ1xuXHRcdFx0c3VybmFtZSA9IHN1cm5hbWVcblxuXHRcdGVsc2UgaWYgc2V4IGlzICdmZW1hbGUnXG5cdFx0XHRpZiBzdXJuYW1lLnN1YnN0cihzdXJuYW1lLmxlbmd0aC0yLHN1cm5hbWUubGVuZ3RoKSBpcyAn0LjQuSdcblx0XHRcdFx0c3VybmFtZSA9IHN1cm5hbWUuc2xpY2UoMCxzdXJuYW1lLmxlbmd0aC0yKVxuXHRcdFx0XHRzdXJuYW1lID0gc3VybmFtZSsn0LDRjydcblx0XHRcdGVsc2Vcblx0XHRcdFx0c3VybmFtZSA9IHN1cm5hbWUrJ2EnIFxuXHRcdG5hbWUgKyAnICcgKyBzdXJuYW1lXHRcdFx0XG4iXX0=